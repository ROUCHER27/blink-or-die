<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blink or Die - æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 40px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h2 {
            color: #ffeb3b;
            margin-top: 0;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .feature-list li:before {
            content: "âœ… ";
            color: #4CAF50;
            font-weight: bold;
        }
        
        .warning-box {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .warning-box h3 {
            color: #ffeb3b;
            margin-top: 0;
        }
        
        .demo-text {
            font-size: 1.1em;
            line-height: 1.8;
            text-align: justify;
        }
        
        .eye-care-tips {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .eye-care-tips h3 {
            color: #a5d6a7;
            margin-top: 0;
        }
        
        .countdown-timer {
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin: 20px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-active {
            background: #4CAF50;
        }
        
        .status-inactive {
            background: #f44336;
            animation: none;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .button {
            display: inline-block;
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‘ï¸ Blink or Die</h1>
        <p class="subtitle">å¹²çœ¼ç—‡æ‹¯æ•‘è€… - è§†åŠ›ä¿æŠ¤æ‰©å±•æµ‹è¯•é¡µé¢</p>
        
        <div class="warning-box">
            <h3>âš ï¸ æ‰©å±•æµ‹è¯•è¯´æ˜</h3>
            <p>è¯·ç¡®ä¿å·²å®‰è£…å¹¶å¯ç”¨äº†Blink or Dieæ‰©å±•</p>
            <p>ç‚¹å‡»æ‰©å±•å›¾æ ‡å¼€å§‹çœ¨çœ¼æ£€æµ‹</p>
        </div>
        
        <div class="countdown-timer" id="countdown">
            ç­‰å¾…æ£€æµ‹...
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ åŠŸèƒ½æµ‹è¯•</h2>
            <ul class="feature-list">
                <li>çœ¨çœ¼æ£€æµ‹ï¼šç›¯ç€å±å¹•ï¼Œ3ç§’å†…ä¸çœ¨çœ¼è¯•è¯•</li>
                <li>è§†è§‰æƒ©ç½šï¼šä½“éªŒå±å¹•é€æ¸æ¨¡ç³Šå˜çº¢çš„æ•ˆæœ</li>
                <li>å³æ—¶æ¢å¤ï¼šçœ¨ä¸€ä¸‹çœ¼ï¼Œå±å¹•ç«‹å³æ¢å¤æ¸…æ™°</li>
                <li>å¾ªç¯æ£€æµ‹ï¼šç³»ç»Ÿä¼šæŒç»­ç›‘æ§ä½ çš„çœ¨çœ¼é¢‘ç‡</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“– æµ‹è¯•æ–‡æœ¬</h2>
            <p class="demo-text">
                è¿™æ˜¯ä¸€æ®µç”¨äºæµ‹è¯•çš„æ–‡æœ¬ã€‚å½“ä½ é•¿æ—¶é—´ç›¯ç€å±å¹•é˜…è¯»æ—¶ï¼Œä½ çš„çœ¨çœ¼é¢‘ç‡ä¼šæ˜¾è‘—é™ä½ï¼Œ
                è¿™å¯èƒ½å¯¼è‡´çœ¼ç›å¹²æ¶©å’Œç–²åŠ³ã€‚Blink or Dieæ‰©å±•ä¼šå¼ºåˆ¶ä½ ä¿æŒæ­£å¸¸çš„çœ¨çœ¼é¢‘ç‡ï¼Œ
                ä»è€Œä¿æŠ¤ä½ çš„è§†åŠ›å¥åº·ã€‚è¯·å°è¯•è¿ç»­é˜…è¯»è¿™æ®µæ–‡å­—è€Œä¸çœ¨çœ¼ï¼Œä½“éªŒæ‰©å±•çš„æ•ˆæœã€‚
            </p>
            <p class="demo-text">
                ç ”ç©¶è¡¨æ˜ï¼Œæ­£å¸¸æƒ…å†µä¸‹äººæ¯åˆ†é’Ÿçœ¨çœ¼15-20æ¬¡ï¼Œä½†ä½¿ç”¨ç”µè„‘æ—¶å¯èƒ½é™è‡³5-7æ¬¡ã€‚
                è¿™ç§å‡å°‘ä¼šå¯¼è‡´æ³ªæ¶²è’¸å‘è¿‡å¿«ï¼Œå¼•å‘å¹²çœ¼ç—‡çŠ¶ã€‚æˆ‘ä»¬çš„æ‰©å±•é€šè¿‡AIæŠ€æœ¯å®æ—¶ç›‘æµ‹ä½ çš„çœ¨çœ¼è¡Œä¸ºï¼Œ
                åœ¨é€‚å½“çš„æ—¶å€™æé†’ä½ çœ¨çœ¼ï¼Œå¸®åŠ©ç»´æŒçœ¼éƒ¨å¥åº·ã€‚
            </p>
        </div>
        
        <div class="eye-care-tips">
            <h3>ğŸ’¡ æŠ¤çœ¼å°è´´å£«</h3>
            <ul>
                <li>éµå¾ª20-20-20æ³•åˆ™ï¼šæ¯20åˆ†é’Ÿçœ‹20è‹±å°ºå¤–çš„ç‰©ä½“20ç§’</li>
                <li>ä¿æŒé€‚å½“çš„å±å¹•è·ç¦»ï¼š50-70å˜ç±³</li>
                <li>è°ƒæ•´å±å¹•äº®åº¦ï¼Œé¿å…è¿‡äº®æˆ–è¿‡æš—</li>
                <li>ç¡®ä¿å®¤å†…å…‰çº¿å……è¶³ï¼Œå‡å°‘å±å¹•åå…‰</li>
                <li>ä½¿ç”¨Blink or Dieæ‰©å±•ï¼Œä¿æŒæ­£å¸¸çœ¨çœ¼é¢‘ç‡</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="#" class="button" onclick="startExtensionTest()">å¼€å§‹æµ‹è¯•æ‰©å±•</a>
        </div>
    </div>
    
    <script>
        // å€’è®¡æ—¶åŠŸèƒ½
        let startTime = Date.now();
        let isDetecting = false;
        
        function updateCountdown() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const remaining = Math.max(0, 3 - elapsed);
            
            const countdownEl = document.getElementById('countdown');
            
            if (isDetecting) {
                if (remaining > 0) {
                    countdownEl.textContent = `${remaining}ç§’`;
                    countdownEl.style.color = remaining <= 5 ? '#f44336' : '#ffeb3b';
                } else {
                    countdownEl.textContent = 'æƒ©ç½šæ¨¡å¼ï¼';
                    countdownEl.style.color = '#f44336';
                }
            } else {
                countdownEl.textContent = 'ç­‰å¾…æ£€æµ‹...';
                countdownEl.style.color = '#ffeb3b';
            }
        }
        
        // æ¨¡æ‹Ÿæ‰©å±•çŠ¶æ€
        function simulateExtension() {
            isDetecting = true;
            startTime = Date.now();
            
            // æ¨¡æ‹Ÿçœ¨çœ¼æ£€æµ‹
            setTimeout(() => {
                // æ¨¡æ‹Ÿçœ¨çœ¼ï¼Œé‡ç½®å€’è®¡æ—¶
                startTime = Date.now();
                console.log('æ¨¡æ‹Ÿçœ¨çœ¼æ£€æµ‹');
            }, Math.random() * 10000 + 5000); // 5-15ç§’éšæœºçœ¨çœ¼
        }
        
        function ensureCameraAccess() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                return Promise.reject(new Error('UNSUPPORTED'));
            }
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                return Promise.reject(new Error('INSECURE_CONTEXT'));
            }
            return navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                stream.getTracks().forEach(t => t.stop());
                return true;
            }).catch(err => {
                return Promise.reject(err);
            });
        }
        
        function connectToExtension(timeoutMs = 2000) {
            return new Promise((resolve) => {
                let settled = false;
                function onMessage(event) {
                    const d = event.data;
                    if (d && d.source === 'blink-or-die' && d.type === 'BOD_PONG') {
                        window.removeEventListener('message', onMessage);
                        if (!settled) {
                            settled = true;
                            resolve(true);
                        }
                    }
                }
                window.addEventListener('message', onMessage);
                window.postMessage({ source: 'test-page', type: 'BOD_PING' }, '*');
                setTimeout(() => {
                    if (!settled) {
                        window.removeEventListener('message', onMessage);
                        settled = true;
                        resolve(false);
                    }
                }, timeoutMs);
            });
        }
        
        async function startExtensionTest() {
            try {
                await ensureCameraAccess();
            } catch (err) {
                let tip = 'æ‘„åƒå¤´æƒé™å¯èƒ½éœ€è¦åœ¨é¡µé¢æˆ–ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸ã€‚';
                if (err && err.message === 'INSECURE_CONTEXT') {
                    tip = 'å½“å‰é¡µé¢ä¸æ˜¯å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå¯èƒ½æ— æ³•ç›´æ¥è®¿é—®æ‘„åƒå¤´ï¼Œä½†æ‰©å±•å¯åœ¨å…¶ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚å»ºè®®é€šè¿‡ http://localhost æˆ– http://127.0.0.1 è®¿é—®ã€‚';
                } else if (err && err.message === 'UNSUPPORTED') {
                    tip = 'æµè§ˆå™¨ä¸æ”¯æŒé¡µé¢æ‘„åƒå¤´ APIï¼Œè¯·ä½¿ç”¨æœ€æ–°çš„ Chromeã€‚æ‰©å±•ä»å¯å°è¯•è¿è¡Œã€‚';
                }
                alert(tip);
            }
            const connected = await connectToExtension();
            if (connected) {
                window.postMessage({ source: 'test-page', type: 'BOD_START_DETECTION' }, '*');
                alert('æ‰©å±•å·²è¿æ¥å¹¶å·²è¯·æ±‚å¼€å§‹æ£€æµ‹');
            } else {
                alert('æœªæ£€æµ‹åˆ°æ‰©å±•é¡µé¢æ¡¥æ¥ï¼Œå·²è¿›å…¥æ¨¡æ‹Ÿæ¨¡å¼');
                simulateExtension();
            }
        }
        
        // å®šæœŸæ›´æ–°å€’è®¡æ—¶
        setInterval(updateCountdown, 1000);
        updateCountdown();
        
        window.addEventListener('message', (event) => {
            const d = event.data;
            if (!d) return;
            if (d.source === 'blink-or-die' && d.type === 'BOD_BLINK_DETECTED') {
                startTime = Date.now();
                console.log('æ£€æµ‹åˆ°çœ¨çœ¼');
            } else if (d.source === 'blink-or-die' && d.type === 'BOD_DETECTION_STARTED') {
                isDetecting = true;
                startTime = Date.now();
                console.log('[Test] æ£€æµ‹å·²å¯åŠ¨');
            } else if (d.source === 'blink-or-die' && d.type === 'BOD_DETECTION_STOPPED') {
                isDetecting = false;
                console.log('[Test] æ£€æµ‹å·²åœæ­¢');
            } else if (d.source === 'blink-or-die' && d.type === 'BOD_ERROR') {
                const msg = d.payload && d.payload.message ? d.payload.message : 'æœªçŸ¥é”™è¯¯';
                console.error('[Test] æ£€æµ‹é”™è¯¯:', d.payload);
                alert(`æ‰©å±•æ£€æµ‹é”™è¯¯: ${msg}`);
                if (d.payload && d.payload.name === 'NotAllowedError') {
                    window.postMessage({ source: 'test-page', type: 'BOD_REQUEST_PERMISSION' }, '*');
                }
            }
        });
    </script>
</body>
</html>